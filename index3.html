<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase3: 몽중몽중몽</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-image: url('imgfinal.jpg');
        }
        img {
            width: 400px;
            height: auto;
            display: block;
            margin: 0 auto;
            padding: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            color: rgb(0, 0, 0);
            background-color: rgb(255, 255, 255);
            text-align: center;
            padding-top: 5%;
            font-size: 20px;
            font-family: 'Helvetica', Arial, sans-serif; 
        }

        video.modal-video {
            width: 80%;
            height: auto;
            max-width: 400px;
            max-height: 250px;
        }

        .button {
            padding: 8px 16px;
            font-size: 1.2em;
            background-color: #000000;
            color: rgb(255, 255, 255);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        #credit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(160, 160, 160);
            z-index: 10001;
            color: white;
            text-align: center;
            padding-top: 10%;
            font-size: 20px;
        }

        .button:hover {
            background-color: #ff1493;
            transform: scale(1.05);
        }

        #click-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            color: white; 
            font-size: 24px; 
            font-family: Arial, sans-serif; 
            z-index: 1000;
        }

        .moving-text {
            position: fixed;
            bottom: 10%; 
            display: inline-block;
            padding: 10px 18px;
            font-size: 16px;
            color: white;
            white-space: nowrap;
            animation: bounceText 10s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55);
            font-family: 'Helvetica', Arial, sans-serif;
        }

        @keyframes bounceText {
            0% { transform: translateX(0); }
            40% { transform: translateX(calc(50vw - 50%)); }
            60% { transform: translateX(calc(50vw - 50%)); }
            100% { transform: translateX(calc(100vw - 100%)); }
        }
    </style>
</head>
<body>
    <audio id="background-audio" src="soundvo.mp3" type="audio/mp3" preload="auto"></audio>
    <div id="click-counter">남은 도형 수: 30</div>
    <div class="moving-text">도형을 부수고 꿈에서 깨어나세요 </div>
    
    <div id="modal" class="modal">
        깨어났습니다! <br> 참 긴 꿈이었네요
        <br><br>
        <img class="custom-image" src="imgfinal.jpg" alt="Description of the image" />
        <button class="button" id="goToFirst">Go to First</button>
        <button class="button" id="goToCredit">Credit</button>
    </div>

    <div id="credit-modal" class="modal">
        <h2>Credits</h2>
        <p>몽중몽, 2024
            <br>Web interaction Design
            <br>
            <br>Videos
            <br>[Lucid dream PSA], Adi Abinun, 2007
            <br>
            <br>Musics
            <br> Phase1 [School Rooftop], Hisohkah, 2020
            <br>  Phase2 [Untitled], Sangyup Han, 2021
            <br>    Phase3 [Starting in the Middle of the Day We Can Drink Our Politics Away], Matching Mole, 1972
            
            <br>© [2024] [Soyong Keem]. All rights reserved.</p>
        <button class="button" id="closeCredit">Close</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/utils/BufferGeometryUtils.js"></script>

    <script>
        let totalClicks = 30;
        let clickCount = 0;
        let shapes = [];

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function updateClickCounter() {
            let remainingClicks = totalClicks - clickCount;
            document.getElementById('click-counter').innerText = `남은 도형 수: ${remainingClicks}`;
        }

        let scene = new THREE.Scene();
        let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        let renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const colors = [0x39ff14, 0xffffff, 0x0000ff, 0xff1493, 0xffd700];

        function getRandomColor() {
            return colors[Math.floor(Math.random() * colors.length)];
        }
        document.body.style.backgroundColor = `#${getRandomColor().toString(16)}`;

        let geometries = ['box', 'sphere', 'cone'];

        let ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        let directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1).normalize();
        scene.add(directionalLight);

        function addRandomShape() {
            let randomGeometry = geometries[Math.floor(Math.random() * geometries.length)];
            let geometry;
            let material = new THREE.MeshLambertMaterial({ color: getRandomColor() });

            switch (randomGeometry) {
                case 'box': geometry = new THREE.BoxGeometry(8, 8, 8); break;
                case 'sphere': geometry = new THREE.SphereGeometry(6, 32, 32); break;
                case 'cone': geometry = new THREE.ConeGeometry(6, 12, 32); break;
            }

            let mesh = new THREE.Mesh(geometry, material);
            mesh.position.set((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20, -60);
            scene.add(mesh);
            shapes.push(mesh);
        }

        function breakShape(object) {
            let position = object.position.clone();
            let material = object.material;

            let pieces = [];
            for (let i = 0; i < 30; i++) {
                let pieceGeometry = new THREE.BoxGeometry(1, 1, 1);
                let pieceMaterial = new THREE.MeshLambertMaterial({ color: material.color });
                let piece = new THREE.Mesh(pieceGeometry, pieceMaterial);

                piece.position.copy(position);
                piece.position.x += (Math.random() - 0.5) * 4;
                piece.position.y += (Math.random() - 0.5) * 4;
                piece.position.z += (Math.random() - 0.5) * 4;

                scene.add(piece);
                pieces.push(piece);
            }

            scene.remove(object);
            shapes = shapes.filter(s => s !== object);

            pieces.forEach(piece => {
                let speed = Math.random() * 2 + 1;
                let direction = new THREE.Vector3((Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2);

                function animatePiece() {
                    piece.position.addScaledVector(direction, speed);
                    piece.rotation.x += 0.1;
                    piece.rotation.y += 0.1;

                    if (Math.abs(piece.position.x) > 50 || Math.abs(piece.position.y) > 50 || Math.abs(piece.position.z) > 50) {
                        scene.remove(piece);
                    } else {
                        requestAnimationFrame(animatePiece);
                    }
                }

                animatePiece();
            });
        }

        window.addEventListener('click', (event) => {
            var audio = document.getElementById('background-audio');
            if (audio.paused) {
                audio.play();
            }

            let raycaster = new THREE.Raycaster();
            let mouse = new THREE.Vector2();

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            let intersects = raycaster.intersectObjects(shapes);

            if (intersects.length > 0) {
                let object = intersects[0].object;
                breakShape(object);
                clickCount++;
                updateClickCounter();

                if (clickCount >= totalClicks) {
                    document.getElementById('modal').style.display = 'block';
                }
            }
        });

        camera.position.z = 40;

        function animate() {
            requestAnimationFrame(animate);
            shapes.forEach(shape => {
                shape.position.z += 1;
                if (shape.position.z > 20) {
                    scene.remove(shape);
                    shapes = shapes.filter(s => s !== shape);
                }
            });
            renderer.render(scene, camera);
        }

        setInterval(addRandomShape, 700);

        document.getElementById('goToFirst').addEventListener('click', function() {
            window.location.href = 'index.html';
        });

        document.getElementById('goToCredit').addEventListener('click', function() {
            document.getElementById('credit-modal').style.display = 'block';
        });

        document.getElementById('closeCredit').addEventListener('click', function() {
            document.getElementById('credit-modal').style.display = 'none';
        });

        animate();

    </script>
</body>
</html>
